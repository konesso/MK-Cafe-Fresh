var bundleSizeLabel="Rozmiar: ",noBundle="Zestaw niedostępny.",disableBundleButton="Nie można dodać do koszyka, ponieważ żaden produkt nie został wybrany.",collection_txt_1="Dodaj wybrane produkty do koszyka",collection_txt_2="Dodaj kolekcję do koszyka",bundleFirstOptionSize="Wybierz rozmiar",bundleVersionNotSelected="Proszę wybrać wariant",bundleSizeSoldOut=" (wyprzedane)";app_shop.fn.bundleSizeSelected=e=>{const t=!!$("#projector_form[data-collection]").length?$("#projector_bundle_product .projector_bundle__checkbox:checked").parents(".projector_bundle__item").find('.projector_bundle__options:not([data-hide]) .projector_bundle__size.f-dropdown .f-dropdown-item.--selected[data-index="0"]'):$('#projector_bundle_product .projector_bundle__options:not([data-hide]) .projector_bundle__size.f-dropdown .f-dropdown-item.--selected[data-index="0"]');if(t.length){if($("body").removeClass("load-content alertek-disabled"),app_shop.fn.projectorBundle.sliderElement&&app_shop.fn.projectorBundle.sliderElement.hasClass("slick-initialized")){const e=t.first().parents(".projector_bundle__item").data("slick-index");app_shop.fn.projectorBundle.sliderElement.slick("slickGoTo",parseInt(e,10)-1)}return e||(Alertek.Start(app_shop.txt.txt_74629_8),t.parents(".projector_bundle__option").addClass("--alert"),setTimeout((()=>{$("#projector_bundle_product .projector_bundle__option").removeClass("--alert")}),3500)),!1}return!0},app_shop.fn.bundleVersionSelected=e=>{const t=!!$("#projector_form[data-collection]").length?$("#projector_bundle_product .projector_bundle__checkbox:checked").parents(".projector_bundle__item").find('.projector_bundle__version.f-dropdown .f-dropdown-item.--selected[data-index="0"]'):$('#projector_bundle_product .projector_bundle__version.f-dropdown .f-dropdown-item.--selected[data-index="0"]');if(t.length){if($("body").removeClass("load-content alertek-disabled"),app_shop.fn.projectorBundle.sliderElement&&app_shop.fn.projectorBundle.sliderElement.hasClass("slick-initialized")){const e=t.first().parents(".projector_bundle__item").data("slick-index");app_shop.fn.projectorBundle.sliderElement.slick("slickGoTo",parseInt(e,10)-1)}return e||(Alertek.Start(bundleVersionNotSelected),t.parents(".projector_bundle__option").addClass("--alert"),setTimeout((()=>{$("#projector_bundle_product .projector_bundle__option").removeClass("--alert")}),3500)),!1}return!0},ProjectorBundle=function(e){const t=this;this.params=e||{},this.updateBundle=()=>{if(document.querySelectorAll("[name^=bundled_product],[name^=bundled_size]").forEach((e=>e.removeAttribute("disabled"))),!app_shop.fn.bundleVersionSelected(!0))return!1;if(!app_shop.fn.bundleSizeSelected(!0))return!1;const e=document.getElementById("projector_product_hidden").value,t="onesize"===document.getElementById("projector_size_hidden").value?"uniw":document.getElementById("projector_size_hidden").value;let r=$("#projector_bundle_product input, #projector_bundle_product select").serialize();const o=document.querySelectorAll(".projector_bundle__checkbox:not(:checked)");o.length&&(r+=`&${[...o].map((e=>`${e.getAttribute("name")}=0`)).join("&")}`);return document.querySelectorAll('.projector_bundle__size.f-dropdown .f-dropdown-item.--selected[data-index="0"]').forEach((e=>{const t=encodeURI(e.closest(".f-dropdown").querySelector("select").getAttribute("name")),o=e.closest(".f-dropdown").querySelector("select option:nth-child(2)").value;r=r.replace(`${t}=`,`${t}=${o}`)})),o.forEach((e=>{e.closest(".projector_bundle__item").querySelectorAll("[name^=bundled_product],[name^=bundled_size]").forEach((e=>e.setAttribute("disabled","disabled")))})),document.body.classList.add("load-content"),$.ajax({type:"POST",url:`/ajax/projector.php?product=${e}&size=${t}&${r}&get=sizeprices,sizeavailability,sizedelivery,bundleprice,bundle`,dataType:"JSON",success:e=>{document.body.classList.remove("load-content"),$.isEmptyObject(e.sizeprices)||(projectorObj.currentSizeObj.price=e.sizeprices,+e.bundleprice.percent_diff>0&&+e.bundleprice.amount_diff_gross>0?(projectorObj.currentSizeObj.price.maxprice=e.bundleprice.price_gross,projectorObj.currentSizeObj.price.maxprice_net=e.bundleprice.price_net,projectorObj.currentSizeObj.price.yousave=e.bundleprice.amount_diff_gross,projectorObj.currentSizeObj.price.yousave_net=e.bundleprice.amount_diff_net,projectorObj.currentSizeObj.price.yousave_percent=e.bundleprice.percent_diff):(projectorObj.currentSizeObj.price.maxprice=e.sizeprices.maxprice,projectorObj.currentSizeObj.price.maxprice_net=e.sizeprices.maxprice_net,projectorObj.currentSizeObj.price.yousave=e.sizeprices.yousave,projectorObj.currentSizeObj.price.yousave_net=e.sizeprices.yousave_net,projectorObj.currentSizeObj.price.yousave_percent=e.sizeprices.yousave_percent)),$.isEmptyObject(e.sizedelivery)||(projectorObj.currentSizeObj.delivery=e.sizedelivery),$.isEmptyObject(e.sizeavailability)||(projectorObj.currentSizeObj.availability=e.sizeavailability),$.isEmptyObject(e.sizeavailability.shipping_time)||(projectorObj.currentSizeObj.shipping_time=e.sizeavailability.shipping_time),$.isEmptyObject(e.sizeavailability.delay_time)||(projectorObj.currentSizeObj.delay_time=e.sizeavailability.delay_time),$.isEmptyObject(e.bundleprice)||(projectorObj.currentSizeObj.bundle_price=e.bundleprice),projectorObj.setCurrentSizeObj(t),o.length===document.querySelectorAll(".projector_bundle__checkbox").length&&document.querySelectorAll(".projector_bundle__checkbox").length>0?projectorObj.configObj.disableBuyButtonTXT=disableBundleButton:projectorObj.configObj.disableBuyButtonTXT="",projectorObj.start(),app_shop.fn.updateYouSave(),e.bundle&&e.bundle.forEach((e=>{const t=document.querySelector(`.projector_bundle__product_id[value="${e.product}"]`),r=!!t&&t.querySelector(".projector_bundle__name_quantity");1!==e.quantity&&r?(r.classList.add("--active"),r.querySelector(".projector_bundle__name_quantity_value").textContent=e.quantity):r&&r.classList.remove("--active")}))},error:()=>{document.body.classList.remove("load-content")}}),!0},this.updateProductSizes=(e,t)=>{const r=t.querySelector(".projector_bundle__option.--sizes"),o=r.querySelector("select")?r.querySelector("select").getAttribute("name"):r.querySelector("input").getAttribute("name");r.innerHTML="",r.removeAttribute("data-hide");const i=document.createElement("div");if(e.items.uniw||null==Object.values(e.items).find((e=>"uniw"!=e.type)))return r.setAttribute("data-onesize","true"),i.innerHTML=`<input class="projector_bundle__product_size" type="hidden" value="onesize" name="${o}" >`,r.appendChild(i.childNodes[0]),this.updateBundle(),!1;if(void 0!==Object.values(e.items).find((e=>"uniw"!=e.type))&&r.removeAttribute("data-onesize"),1===Object.keys(e.items).length){const t=Object.values(e.items).map((e=>`${e.type}`)).join(""),n=`<a class="projector_bundle__size_button --selected${0===Object.values(e.items).map((e=>`${e.type}`)).join("")?" --disabled":""}" href="#${t}" data-value="${t}">\n        <input class="projector_bundle__product_size" type="hidden" value="${t}" name="${o}" />\n        <span class="projector_bundle__size_name">${Object.values(e.items).map((e=>`${e.description}`)).join("")}</span>\n      </a>`;return i.innerHTML=n,r.appendChild(i.childNodes[0]),this.initBundleSizes(),this.updateBundle(),!1}const n=`<select class="projector_bundle__size f-select --small --placeholder" name="${o}"  data-label="${bundleSizeLabel}">\n      <option>${bundleFirstOptionSize}</option>\n      ${Object.values(e.items).map((e=>`<option${0===e.amount?` class="--disabled" label="${e.description}${bundleSizeSoldOut}"`:" "} value="${e.type}" data-count="${e.amount}">${e.description}</option>`)).join("")}\n    </select>`;return i.innerHTML=n,r.appendChild(i.childNodes[0]),this.initBundleSizes(),this.updateBundle(),!0},this.showElement=e=>{if(!e)return!1;e.removeAttribute("style")},this.hideElement=e=>{if(!e)return!1;e.setAttribute("style","display: none")},this.updateProductInBundle=(e,r,o)=>{document.body.classList.add("load-content"),$.ajax({type:"POST",url:`/ajax/projector.php?product=${e}&get=sizeprices,multiversions,sizes,pictures,bundle`,dataType:"JSON",success:i=>{document.body.classList.remove("load-content");const n=r.querySelector(".projector_bundle__availability"),s=r.querySelector(".projector_bundle__availability_quantity"),l=r.querySelector(".projector_bundle__icon"),d=r.querySelector(".projector_bundle__name_value"),c=r.querySelector(".projector_bundle__product_id"),a=r.querySelector(".projector_bundle__price"),u=Object.keys(i.sizes.items).filter((e=>0!==i.sizes.items[e].amount));0!==i.sizes.amount||u.length?this.hideElement(n):this.showElement(n),i.sizes.amount>0&&+s?.getAttribute("data-bundle_quantity")>i.sizes.amount?this.showElement(s):this.hideElement(s),s?.querySelector("a")?.setAttribute("href",o),l&&(l.setAttribute("href",o),l.querySelector("img")&&(i.pictures[1]&&l.querySelector("img").setAttribute("src",i.pictures[1].data.icon),l.querySelector("img").setAttribute("alt",i.sizes.name))),d&&(d.setAttribute("href",o),d.textContent=i.sizes.name),c&&(c.value=e),a&&(a.textContent="net"===app_shop.vars.priceType?i.sizeprices.price_net_formatted:i.sizeprices.price_formatted,"net"===app_shop.vars.priceType&&"0.00"===i.sizeprices.price_net||"net"!==app_shop.vars.priceType&&"0.00"===i.sizeprices.value?this.hideElement(a.parentNode):this.showElement(a.parentNode)),t.updateProductSizes(i.sizes,r)},error:()=>{document.body.classList.remove("load-content")}})},this.dropdownBundleMultiVersionsClick=e=>{e.querySelectorAll(".f-dropdown-li").forEach((r=>{r.addEventListener("click",(function(r){r.preventDefault();const o=this.querySelector(".f-dropdown-item"),i=e.querySelectorAll(".f-dropdown-item"),n=o.getAttribute("data-index"),s=o.innerHTML,l=e.querySelector("select"),d=e.querySelector("button.f-dropdown-toggle"),c=d.querySelector(".f-dropdown-button"),a=o.getAttribute("data-product"),u=o.getAttribute("data-link"),p=e.closest(".projector_bundle__item");if(!o.classList.contains("--selected")){i.forEach((e=>e.classList.remove("--selected"))),o.classList.add("--selected"),l.selectedIndex=n,c.innerHTML=s,d.setAttribute("data-indexcurrent",o.getAttribute("data-index")),e.classList.remove("--open");const r=`&multiversions[selected]=${[...p.querySelectorAll(".projector_bundle__option.--versions .f-dropdown-item.--selected")].map((e=>e.getAttribute("data-values_id"))).join(",")}&multiversions[last_selected]=${o.getAttribute("data-values_id")}`;$.ajax({url:`/ajax/projector.php?product=${a}&get=multiversions${r}`,type:"get",dataType:"json",success:function(e){e.multiversions.forEach((e=>{const t=p.querySelector(`.projector_bundle__option.--versions[data-id="${e.id}"]`);t&&t.classList.remove("--conflict"),Object.values(e.items).forEach((e=>{const r=p.querySelector('.projector_bundle__option.--versions .f-dropdown-item[data-values_id="'+e.values_id+'"]');r&&(r.parentNode.classList.remove("--dependent"),r.setAttribute("data-product",e.products[0].product_id),r.setAttribute("data-link",e.products[0].url),e.disabled&&(r.classList.contains("--selected")&&t.classList.add("--conflict"),r.parentNode.classList.add("--dependent")))}))}));p.querySelectorAll(".projector_bundle__option.--versions.--conflict").length||t.updateProductInBundle(a,p,u)},error:()=>{}})}return!1}))}))},this.dropdownBundleMultiVersionsGenerate=e=>{e.querySelectorAll("option[label]").forEach((e=>{e.textContent=e.getAttribute("label")}))},this.initBundleMultiVersions=()=>{app_shop.fn.projectorMultiVersionsSelect=new SelectToDropdown({selector:".projector_bundle__version:not(.f-dropdown)",generateDropdownCallback:!!this.dropdownBundleMultiVersionsGenerate&&this.dropdownBundleMultiVersionsGenerate,clickDropdownCallback:!!this.dropdownBundleMultiVersionsClick&&this.dropdownBundleMultiVersionsClick})},this.updateProductPriceAfterSelectSize=(e,t,r)=>{document.body.classList.add("load-content"),$.ajax({type:"POST",url:`/ajax/projector.php?product=${e}&size=${t}&get=sizeprices,size,sizeavailability`,dataType:"JSON",success:e=>{document.body.classList.remove("load-content");const t=r.querySelector(".projector_bundle__price"),o=r.querySelector(".projector_bundle__availability"),i=r.querySelector(".projector_bundle__availability_quantity");t&&(t.textContent="net"===app_shop.vars.priceType?e.sizeprices.price_net_formatted:e.sizeprices.price_formatted,"net"===app_shop.vars.priceType&&"0.00"===e.sizeprices.price_net||"net"!==app_shop.vars.priceType&&"0.00"===e.sizeprices.value?this.hideElement(t.parentNode):this.showElement(t.parentNode)),"disable"===e.sizeavailability.status?this.showElement(o):this.hideElement(o),e.size.amount>0&&+i?.getAttribute("data-bundle_quantity")>e.size.amount?this.showElement(i):this.hideElement(i),this.updateBundle()},error:()=>{document.body.classList.remove("load-content")}})},this.dropdownBundleSizesGenerate=e=>{e.querySelectorAll("option[label]").forEach((e=>{e.textContent=e.getAttribute("label")}))},this.dropdownBundleSizesAfterClick=e=>{document.body.classList.add("load-content");const t=e.querySelector(".f-dropdown-item").getAttribute("data-value"),r=e.closest(".projector_bundle__item"),o=r.querySelector(".projector_bundle__product_id").value;this.updateProductPriceAfterSelectSize(o,t,r)},this.initBundleSizes=()=>{app_shop.fn.projectorSizesSelect=new SelectToDropdown({selector:".projector_bundle__size:not(.f-dropdown)",generateDropdownCallback:!!this.dropdownBundleSizesGenerate&&this.dropdownBundleSizesGenerate,afterClickDropdownCallback:!!this.dropdownBundleSizesAfterClick&&this.dropdownBundleSizesAfterClick});document.querySelectorAll(".projector_bundle__size_button:not(.--event)").forEach((e=>{e.classList.add("--event"),e.addEventListener("click",(function(e){e.preventDefault(),this.classList.add("--selected");const r=this.getAttribute("data-value"),o=this.closest(".projector_bundle__item"),i=o.querySelector(".projector_bundle__product_id").value;return t.updateProductPriceAfterSelectSize(i,r,o),!1}))}))},this.sliderDefaults={prevArrow:'<a class="projector_bundle__arrow --prev" href=""><i class="icon-angle-left"></i></a>',nextArrow:'<a class="projector_bundle__arrow --next" href=""><i class="icon-angle-right"></i></a>',arrows:!0,slidesToShow:2,slidesToScroll:1,infinite:!1},this.resetSlider=()=>{this.sliderElement&&this.sliderElement.hasClass("slick-initialized")&&this.sliderElement.slick("unslick"),this.init(this.params)},this.destroySlider=()=>{this.sliderElement&&this.sliderElement.hasClass("slick-initialized")&&this.sliderElement.slick("unslick")},this.initSlider=()=>{"function"==typeof this.beforeSliderCallback&&this.beforeSliderCallback(this.sliderElement),this.sliderElement.on("afterChange",(function(){app_shop.vars.bLazy&&app_shop.vars.bLazy.revalidate()})),this.sliderElement.slick(this.sliderSettings),"function"==typeof this.afterSliderCallback&&this.afterSliderCallback(this.sliderElement)},this.initEvents=()=>{document.querySelectorAll(".projector_bundle__chart_link").forEach((e=>{e.addEventListener("click",(function(e){e.preventDefault(),e.stopPropagation();const t=this.getAttribute("data-id");return Modal({element:$(t),classList:"--sizes-chart --medium"}),!1}))}));document.querySelectorAll(".projector_bundle__checkbox").forEach((e=>{e.addEventListener("click",(function(){t.updateBundle()}))}))},this.init=()=>{const{sliderSelector:e,sliderOptions:t,beforeSliderCallback:r,afterSliderCallback:o}=this.params;this.sliderSettings={...this.sliderDefaults,...t},this.sliderSelector=e||".projector_bundle__block",this.sliderElement=$(this.sliderSelector),this.beforeSliderCallback=r,this.afterSliderCallback=o,this.initBundleMultiVersions(),this.initBundleSizes(),this.initEvents(),this.updateBundle()}};